<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <style>
.dartboard-segment:hover {
  fill: rgb(100, 100, 255);
}
  </style>
</head>
<body>
<div id="dartboard">
  <svg id="dartboard-svg" width="100%" height="100%" viewBox="0 0 1000 1000"></svg>
</div>

<script type="text/javascript" data-main="scripts/app" src="scripts/libs/jquery/jquery.min.js"></script>
<script>
$(function() {
console.log('start');

var $svg = $('#dartboard-svg'),
  radius = 500,
  center = { x: radius, y: radius },
  svgDefs = '',
  svgContents = '<rect class="scorable" width="1000" height="1000" fill="rgb(255, 255, 255)" data-factor="2"/>' +
    '<circle class="scorable" cx="' + center.x + '" cy="' + center.y + '" r="' + radius + '" fill="rgb(50,50,50)" />',
  marks = {
      textPosition: 0.90,
      outerDouble: 0.85,
      innerDouble: 0.80,
      outerTriple: 0.53,
      innerTriple: 0.48,
      outerSingleBull: 0.07,
      outerDoubleBull: 0.03
  },
  numberOrder = [
    20, 1,  18, 4,  13,
    6,  10, 15, 2,  17,
    3,  19, 7,  16, 8,
    11, 14, 9,  12, 5
  ],
  factors = [ 3, 1, 2, 1 ],
  boardColors = [
    [ "rgb(0,150,61)",    "rgb(206,21,0)" ],
    [ "rgb(255,255,255)", "rgb(0,0,0)" ]
  ],
  pieces = [
    [ marks.outerDouble, marks.innerDouble ],
    [ marks.innerDouble, marks.outerTriple ],
    [ marks.outerTriple, marks.innerTriple ],
    [ marks.innerTriple, marks.outerSingleBull ]
  ];

function makePoints(center, radius, startAngle, endAngle, startRatio, endRatio) {
  return [
    {
      x: center.x + radius * Math.cos(startAngle) * startRatio,
      y: center.y + radius * Math.sin(startAngle) * startRatio
    },
    {
      x: center.x + radius * Math.cos(endAngle) * startRatio,
      y: center.y + radius * Math.sin(endAngle) * startRatio
    },
    {
      x: center.x + radius * Math.cos(endAngle) * endRatio,
      y: center.y + radius * Math.sin(endAngle) * endRatio
    },
    {
      x: center.x + radius * Math.cos(startAngle) * endRatio,
      y: center.y + radius * Math.sin(startAngle) * endRatio
    }
  ];
}

var startAngle = - 11 * Math.PI / 20;

for(i = 0; i < 20; i++) {
  var endAngle = startAngle + Math.PI / 10;

  for(var j = 0; j < 4; j++) {
    var startRatio = pieces[j][0],
      endRatio = pieces[j][1],
      points = makePoints(center,radius, startAngle, endAngle, startRatio, endRatio),
      color = boardColors[j % 2][i % 2],
      outerRadius = startRatio * radius,
      innerRadius = endRatio * radius,
      d = [
        "M", points[0].x, points[0].y,
        "A", outerRadius, outerRadius, 1, 0, 1, points[1].x, points[1].y,
        "L", points[2].x, points[2].y,
        "A", innerRadius, innerRadius, 1, 0, 0, points[3].x, points[3].y,
        "L", points[0].x, points[0].y,
        "Z"
      ],
      contents = '<path class="scorable dartboard-segment" ' +
        'data-score="' + numberOrder[i] + '" ' +
        'data-factor="' + factors[j] + '" ' +
        'd="' + d.join(" ") + '" fill="' + color + '"/>';
    svgContents += contents;
  }

  var textRadius = marks.textPosition * radius,
    textStart = {
      x: center.x + textRadius * Math.cos(startAngle),
      y: center.y + textRadius * Math.sin(startAngle)
    },
    textEnd = {
      x: center.x + textRadius * Math.cos(endAngle),
      y: center.y + textRadius * Math.sin(endAngle)
    };
  svgDefs += '<path id="dartboard-text-path-' + numberOrder[i] + '" d="' +
    [
      "M", textStart.x, textStart.y,
      "A", textRadius, textRadius, 0, 0, 1, textEnd.x, textEnd.y
    ].join(" ") +
    '"/>';

  svgContents +=
    '<text x="0" y="0" text-anchor="middle" font-size="' + (radius / 15) + '" fill="white" font-family="Arial">' +
    '<textPath xlink:href="#dartboard-text-path-' + numberOrder[i] + '" startOffset="50%">' + numberOrder[i] + '</textPath>' +
    '</text>';

  startAngle = endAngle;
}

var outerRadius = marks.outerSingleBull * radius,
  innerRadius = marks.outerDoubleBull * radius,
  singleBull = '<path class="scorable dartboard-segment" ' +
      'data-score="25" data-factor="1" ' +
      'd="' + [
        "M", center.x, center.y - outerRadius,
        "A", outerRadius, outerRadius, 0, 0, 1, center.x, center.y + outerRadius,
        "A", outerRadius, outerRadius, 0, 0, 1, center.x, center.y - outerRadius,
        "z",
        "M", center.x, center.y - innerRadius,
        "A", innerRadius, innerRadius, 0, 0, 0, center.x, center.y + innerRadius,
        "A", innerRadius, innerRadius, 0, 0, 0, center.x, center.y - innerRadius,
        "z"
      ].join(" ") + '" ' +
      'fill="' + boardColors[0][0] + '" fill-rule="evenodd"/>',
    doubleBull = '<circle class="scorable dartboard-segment" ' +
      'data-score="25" data-factor="2" ' +
      'cx="' + center.x + '" cy="' + center.y + '" ' +
      'r="' + innerRadius + '" fill="' + boardColors[0][1] + '" />';

svgContents += singleBull + doubleBull;

$svg.html('<defs>' + svgDefs + '</defs>' + svgContents);

$svg.children('.scorable').on('click', function(evt) {
  var score = $(this).data('score') || 0,
    factor = $(this).data('factor') || 0;
  console.log('click', score, factor, this);
});

console.log('end');

});
</script>
</body>
</html>
